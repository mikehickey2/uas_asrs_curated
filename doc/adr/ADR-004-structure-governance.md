# ADR-004: Project Structure Governance

**Date:** 2025-12-27
**Status:** Accepted

## Context

As the project grows, there is risk of "structure creep" where scripts or agents
create new top-level directories or asset categories without explicit governance.
This fragments the project layout and makes it harder to understand what exists
and why.

The project currently has a defined structure documented in README.md. We need
explicit rules about what directories exist, what can be auto-created, and what
requires approval.

## Decision

### Approved Top-Level Directories

The following top-level directories are approved for this project:

| Directory | Purpose | Auto-create allowed? |
|-----------|---------|---------------------|
| `R/` | Functions and utilities | No |
| `scripts/` | Executable scripts (import, dev, eda) | No |
| `tests/` | Test suite | No |
| `doc/` | Documentation (data dictionary, ADRs) | No |
| `assets/` | Static inputs for rendering | No |
| `data/` | Raw ASRS CSV exports | No |
| `output/` | Generated outputs (see below) | Subdirectories only |
| `renv/` | Package management (managed by renv) | Managed by renv |

### Auto-Creation Rules

Scripts may auto-create **only** subdirectories within `output/`:

| Allowed subdirectory | Purpose |
|---------------------|---------|
| `output/tables/` | Machine-readable CSV tables |
| `output/figures/` | Publication-ready PNG figures |
| `output/reports/` | Rendered HTML and DOCX reports |
| `output/notes/` | Working markdown documents |
| `output/crosswalk/` | Crosswalk/mapping files (if needed) |

Scripts must use `dir.create(..., showWarnings = FALSE, recursive = TRUE)` for
these directories.

### No Structure Creep Rule

**Any new top-level directory or new output subdirectory category requires
explicit user approval before implementation.** This applies to:

- Human developers proposing changes
- AI agents (Claude Code, Copilot, etc.) suggesting modifications
- CI/CD pipelines or automation

Violations should be caught in code review. If a script attempts to create an
unapproved directory, it should fail or warn loudly.

### Assets Policy

The `assets/` directory contains **static inputs required for rendering**:

| File | Purpose |
|------|---------|
| `assets/apa_reference.docx` | APA reference document for Word output |

**Rules for `assets/`:**
1. Assets are inputs, not outputs (they are consumed, not produced)
2. Adding new files under `assets/` requires user approval
3. New asset types require an ADR update or addendum documenting the addition
4. Assets should not be auto-generated by scripts (exception: one-time bootstrap
   scripts like `13_create_apa_reference.R` that create reference docs)

## Consequences

### Positive

- Clear boundaries prevent ad-hoc directory proliferation
- Easier onboarding: new contributors know exactly what directories exist and why
- Reproducibility: project structure is documented and stable
- AI agents have explicit guardrails for what they can create

### Negative

- Requires approval step for legitimate new directories (minor friction)
- May need ADR updates as project evolves

### Alternatives Considered

**Alternative A: No governance, organic growth**
Rejected because it leads to inconsistent structure and confusion about where
files belong.

**Alternative B: Strict lockdown with no auto-creation**
Rejected because requiring manual directory creation for every pipeline run
adds unnecessary friction. Auto-creation within `output/` is reasonable.

## Enforcement

1. **Code review**: Reviewers check for unapproved `dir.create()` calls outside
   `output/` subdirectories
2. **CLAUDE.md rule**: AI agents are instructed not to create new top-level
   directories without explicit approval
3. **Documentation**: README.md and this ADR document the approved structure

## References

- [Cookiecutter Data Science](https://drivendata.github.io/cookiecutter-data-science/) -
  Standard project template emphasizing consistent structure
- [R for Data Science (2e)](https://r4ds.hadley.nz/workflow-scripts.html) -
  Recommends organizing files by type in dedicated directories
- Wilson, G., et al. (2017). Good enough practices in scientific computing.
  *PLOS Computational Biology*. "Consistency and predictability are more
  important than hairsplitting."